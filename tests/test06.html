<html>
  <head>
    <title>HotDrink Test</title>
    <script type="text/javascript" src="hotdrink.js"></script>
    <script type="text/javascript">
function calcLeft() {
  return this.right - this.width;
}

function calcRight() {
  return this.left + this.width;
}

function calcWidth() {
  var m= 2000000000 + (Math.random() * 2000000000);
  for (var i= 0; i < m; ++i);
  return this.right - this.left;
}

function calcTop() {
  return this.bottom - this.height;
}

function calcBottom() {
  return this.top + this.height;
}

function calcHeight() {
  return this.bottom - this.top;
}

function calcWidthAspect() {
  var m= 2000000000 + (Math.random() * 2000000000);
  for (var i= 0; i < m; ++i);
  return this.height * this.aspect;
}

function calcHeightAspect() {
  return this.width / this.aspect;
}

function calcAspect() {
  return this.width / this.height;
}

var m;
function init() {
  hd.builder
    .variables( {left: 0, top: 0, right: undefined, bottom: undefined,
                 width: 200, height: 200, aspect: undefined} )

    .constraint()
    .method( 'right, width -> left', calcLeft )
    .method( 'left, width -> right', calcRight )
    .method( 'left, right -> width', hd.async( calcWidth ) )

    .constraint()
    .method( 'bottom, height -> top', calcTop )
    .method( 'top, height -> bottom', calcBottom )
    .method( 'top, bottom -> height', calcHeight )

    .constraint()
    .method( 'aspect, height -> width', hd.async( calcWidthAspect ) )
    .method( 'aspect, width -> height', calcHeightAspect )
    .method( 'width, height -> aspect', calcAspect )

  hd.bind();

}
    </script>
    <style type="text/css">
      .pending { background: #ccc; }
      .source  { background: #ffc; }
    </style>
  </head>
  <body onload="init()">
    <p>
      Test asynchronous evaluation with source &amp; pending flags.
    </p>
    <table>
      <tr>
        <td>Left:</td>
        <td><input type="text" data-bind="number: left, css: left"/></td>
        <td>Right:</td>
        <td><input type="text" data-bind="number: right, css: right"/></td>
        <td>Width:</td>
        <td><input type="text" data-bind="number: width, css: width"/></td>
        <td rowspan="2">Aspect:</td>
        <td rowspan="2"><input type="text" data-bind="number: aspect, css: aspect"/></td>
      </tr>
      <tr>
        <td>Top:</td>
        <td><input type="text" data-bind="number: top, css: top"/></td>
        <td>Bottom:</td>
        <td><input type="text" data-bind="number: bottom, css: bottom"/></td>
        <td>Height:</td>
        <td><input type="text" data-bind="number: height, css: height"/></td>
      </tr>
    </table>
  </body>
</html>
